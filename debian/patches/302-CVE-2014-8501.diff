#! /bin/sh /usr/share/dpatch/dpatch-run
Description: CVE-2014-8501 fix
Author: Luciano Bello <luciano@debian.org> 
Origin: backport: https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;h=7e1e19887abd24aeb15066b141cdff5541e0ec8e
Applied-Upstream: commit: 7e1e19887abd24aeb15066b141cdff5541e0ec8e
---
@DPATCH@
--- a/bfd/peXXigen.c
+++ b/bfd/peXXigen.c
@@ -461,6 +461,17 @@ _bfd_XXi_swap_aouthdr_in (bfd * abfd,
   {
     int idx;
 
+    /* PR 17512: Corrupt PE binaries can cause seg-faults.  */
+    if (a->NumberOfRvaAndSizes > 16)
+      {
+       (*_bfd_error_handler)
+         (_("%B: aout header specifies an invalid number of data-directory entries: %d"),
+          abfd, a->NumberOfRvaAndSizes);
+       /* Paranoia: If the number is corrupt, then assume that the
+          actual entries themselves might be corrupt as well.  */
+       a->NumberOfRvaAndSizes = 0;
+      }
+
     for (idx = 0; idx < 16; idx++)
       {
         /* If data directory is empty, rva also should be 0.  */
